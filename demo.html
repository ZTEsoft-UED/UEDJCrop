
<!DOCTYPE html>
<!--[if IE 8]> <html lang="en" class="ie8 no-js"> <![endif]-->
<!--[if IE 9]> <html lang="en" class="ie9 no-js"> <![endif]-->
<!--[if !IE]><!-->
<html lang="zh-CN" class="no-js">
<!--<![endif]-->
<head> 
     <title>ZSmart UED 上传照片</title> 
     <meta charset="UTF-8"/>
     <meta http-equiv="X-UA-Compatible" content="IE=Edge">
     <meta content="width=device-width, initial-scale=1.0" name="viewport"/> 
     <link href="http://10.45.7.86/assets/css/home.css" rel="stylesheet" /> 

<style type="text/css">
body{font-family: Arial, '微软雅黑';margin:0 auto;padding:0; background:url(images/bg.jpg) repeat;font-size:12px;color:#000;}
.container { width:1080px; margin:0px auto; }
.section { background-color:#fff; padding:10px;}
.row{overflow:hidden; margin-top:20px;line-height:30px;padding-left:94px;}
.row span.label{float:left;position:relative;line-height:30px;margin-left:-94px;width:84px;text-align:right; color:#5b5b5b;}
.btn_submit {background:url(images/submit.gif) no-repeat;width:70px;height:29px;border:0;}
.btn {
    height:25px;
    width: 100px;
    margin-bottom: 0;
    font-size: 14px;
    line-height: 25px;
    border: 0px solid #ccc;
    text-align: center;
    cursor: pointer;
    float: left;
    margin-right: 20px;
    color: #fff;
    text-decoration:none;
}
.yellow {
    background-color: #FFA200;
}
.black {
    background-color: #33383E;
}
.page-header-fixed .page-container{
    margin-top: 0;
}
</style>

</head>  
<body class="page-header-fixed">
    <!-- BEGIN HEADER -->
    <div class="header ">
        <div class="navbar">    
            <h1 class="logo "><a title="ZSmart UED" name="head" href="#">ZSmart UED</a></h1> 
            <div class="header-inner">
                <ul class="nav">
                 <li class="current-menu-item  menu-item menu-item-type-custom menu-item-object-custom menu-item-13" id="menu-item-13"><a href="/">设计作品</a></li>
                    <li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-12" id="menu-item-12"><a href="/ued">设计视角</a></li>
                    <li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-9"><a href="/ued/?cat=37">团队生活</a></li>
                    <li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-9" id="menu-item-9"><a href="/about.html">关于我们</a></li>
                </ul>
                <div class="screen-mini">
                    <button class="btn btn-inverse screen-nav" data-type="screen-nav"><i class="icon-tasks icon-white"></i></button>
                </div> 
            </div>
        </div>
    </div>  
    <!-- END TOP NAVIGATION BAR -->
    <!-- END HEADER -->

    <div class="clearfix">
    </div>
    <!-- BEGIN CONTAINER -->
    <div class="page-container ">
        <!-- BEGIN CONTENT -->
        <div class="page-content-wrapper">
            <div class="page-content-wrapper">
                <div class="page-content">
                    <div class="row">
                        <div class="col-md-10 col-md-offset-1">
                           

<div class="container">
    <div class="section">
        <div class="row" id="avatar_msg" style="font-weight:700;color:#f00;display:none;">上传成功，让我们一起摇摆！</div>
        <div class="row" style="   width: 100%;">
            <label><span class="label">当前照片：</span></label>
            <img id="avatar" src="images/default.jpg"  />
        </div>
        <div class="row">
            <label><span class="label"> 上传照片：</span></label>
            <input type="text" id="avatarUpload" value="" />
            <input type="hidden" id="img" name="img" />
            <input type="hidden" id="x" name="x" />
            <input type="hidden" id="y" name="y" />
            <input type="hidden" id="w" name="w" />
            <input type="hidden" id="h" name="h" />
            <div style="padding-top:-10px;">
                <a href="javascript:$('#avatarUpload').uploadify('upload','*')" class="btn yellow">开始上传</a>
                <a href="javascript:$('#avatarUpload').uploadify('cancel', '*')"  class="btn black">取消上传</a>
            </div>
        </div>
        <div class="row imgchoose" style="display:none;">编辑照片：<br /><img src="" id="target" /></div>
        <div class="row imgchoose" style="display:none;">
            照片预览：<br />
            <div style="width:200px;height:200px;margin:10px 10px 10px 0;overflow:hidden; float:left;"><img class="preview" id="preview3" src="" /></div>
            <!-- <div style="width:130px;height:130px;margin:80px 0 10px;overflow:hidden; float:left;"><img class="preview" id="preview2" src="" />
            </div>
            <div style="width:112px;height:112px;margin:98px 0 10px 10px;overflow:hidden; float:left;"><img class="preview" id="preview" src="" />
            </div> -->
        </div>
        <div class="row">
            <input type="button" class="btn_submit" value="" id="avatar_submit" style="display:none;" />
        </div>
    </div>
</div>


                        </div>
                    </div>
                    <!-- END PAGE HEADER-->
                     
                </div>
            </div>
        </div>
        <!-- END CONTENT -->
    </div> 
    <div class="footer">
        <div class="foot-link">
            <a href="/ued/">Home</a>|
            <a href="/about.html">About</a>|
            <a href="/join.html">Join us</a>            
        </div>
        <div class="footer-inner">
             Copyright © 2014 ZSmart UED. All rights reserved.  
            <!--<span>( 建议使用IE9及以上版本浏览器进行浏览 )</span>  class="notice-tips" -->
        </div>
    </div>
    <div class="ue-survey rollto" data-type="totop"> 
        <ul class="sidebar sidebar_panel">
            <li class="gotop">
                <a title="返回顶部" href="#head"  class="sidebar_advice go-top">             
                </a>
            </li>
        </ul>
    </div>  
 
<script src="js/jquery.js"></script>
<link href="uploadify/uploadify.css" type="text/css" rel="stylesheet" />
<script type="text/javascript" src="uploadify/jquery.uploadify-3.1.js"></script>
<script type="text/javascript" src="jcrop/jquery.Jcrop.min.js"></script>
<link rel="stylesheet" href="jcrop/jquery.Jcrop.css" type="text/css" />
<script type="text/javascript">
$(function() {
    //首页轮播图1
    $("#avatarUpload").uploadify({
        'debug'             : false,    //开启调试
        'auto'              : false,  //是否自动上传
        'multi'             : false,
        'uploadLimit'       : 1,
        'formData'          : {'uid':'118'}, //附带值
        'buttonText'        : '请选择图片',
        'height'            : 25,
        'width'             : 120,
        'removeCompleted'   : false,
        'swf'               : 'uploadify/uploadify.swf',
        'uploader'          : 'upload.php',
        'fileTypeExts'      : '*.gif; *.jpg; *.jpeg; *.png;',
        'fileSizeLimit'     : '5200KB',
        'onUploadSuccess' : function(file, data, response) {
            var msg = $.parseJSON(data);
            if( msg.result_code == 1 ){
                $("#img").val( msg.result_des );
                $("#target").attr("src",msg.result_des);
                $(".preview").attr("src",msg.result_des);
                $('#target').Jcrop({
                    minSize: [50,50],
                    setSelect: [0,0,200,200],
                    onChange: updatePreview,
                    onSelect: updatePreview,
                    onSelect: updateCoords,
                    aspectRatio: 1
                },
                function(){
                    // Use the API to get the real image size
                    var bounds = this.getBounds();
                    boundx = bounds[0];
                    boundy = bounds[1];
                    // Store the API in the jcrop_api variable
                    jcrop_api = this;
                });
                $(".imgchoose").show(100);
                $("#avatar_submit").show(100);
                $('html,body').animate({scrollTop:$('#avatarUpload').offset().top+160},1000,'swing');
            } else {
                alert('图片上传失败');
            }
        },
        'onClearQueue' : function(queueItemCount) {
            alert( $('#img1') );
        },
        'onCancel' : function(file) {
            alert('The file ' + file.name + ' was cancelled.');
        }
    });
    
    //照片裁剪
    var jcrop_api, boundx, boundy;
    
    function updateCoords(c)
    {
        $('#x').val(c.x);
        $('#y').val(c.y);
        $('#w').val(c.w);
        $('#h').val(c.h);
    };
    function checkCoords()
    {
        if (parseInt($('#w').val())) return true;
        alert('请选择图片上合适的区域');
        return false;
    };
    function updatePreview(c){ 
            var rx = 200 / c.w;
            var ry = 200 / c.h;
            $('#preview3').css({
                width: Math.round(rx * boundx) + 'px',
                height: Math.round(ry * boundy) + 'px',
                marginLeft: '-' + Math.round(rx * c.x) + 'px',
                marginTop: '-' + Math.round(ry * c.y) + 'px'
            }); 
    };
    
    $("#avatar_submit").click(function(){
        var img = $("#img").val();
        var x = $("#x").val();
        var y = $("#y").val();
        var w = $("#w").val();
        var h = $("#h").val();
        if( checkCoords() ){
            $.ajax({
                type: "POST",
                url: "resize.php",
                data: {"img":img,"x":x,"y":y,"w":w,"h":h},
                dataType: "json",
                success: function(msg){
                    if( msg.result_code == 1 ){
                        $('html,body').animate({scrollTop:$('#avatar').offset().top-150},1000,'swing',function(){
                            $('#avatar_msg').show();
                            $('#avatar').attr('src',msg.result_des.big);
                        });
                    } else {
                        alert("图片没弄好，失败咯");
                    }
                }
            });
        }
    });
});
</script>

</body>
</html>